<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Audio Speed Controller</title>
    <style>
        body {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Audio Speed Controller</h1>
    <p>Speed: <span id="speedValue">1.0</span>x</p>

    <input type="range" id="speedControl" min="0.5" max="2.0" step="0.1" value="1.0">

    <br><br>
    <button id="playButton">Play / Pause</button>
    <button id="rewindButton">Rewind</button>

    <script src="https://cdn.jsdelivr.net/npm/soundtouch-js/dist/soundtouch.min.js"></script>
    <script>
        const audioUrl = "https://archive.org/download/short_poetry_092_librivox/andsodidi_cox_gg_64kb.mp3";
        const speedSlider = document.getElementById("speedControl");
        const speedValue = document.getElementById("speedValue");
        const playButton = document.getElementById("playButton");
        const rewindButton = document.getElementById("rewindButton");

        let audioContext;
        let audioBuffer;
        let sourceNode = null;
        let startTime = 0;
        let pausedAt = 0;
        let playbackRate = 1.0;
        let isPlaying = false;
        let soundTouch;

        async function loadAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const response = await fetch(audioUrl);
            const arrayBuffer = await response.arrayBuffer();
            audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
            soundTouch = new SoundTouch();
            soundTouch.setTempo(playbackRate);
            soundTouch.setPitchSemiTones(0);
            soundTouch.setRate(playbackRate);
        }

        function startSource(offset = 0) {
            sourceNode = audioContext.createBufferSource();
            sourceNode.buffer = audioBuffer;
            sourceNode.connect(audioContext.destination);
            startTime = audioContext.currentTime - offset / playbackRate;
            sourceNode.start(0, offset);
            sourceNode.onended = () => {
                isPlaying = false;
                pausedAt = 0;
                sourceNode = null;
            };
            isPlaying = true;
        }

        function playAudio() {
            if (!audioBuffer) return;
            if (sourceNode) return;
            startSource(pausedAt);
        }

        function pauseAudio() {
            if (!sourceNode) return;
            pausedAt = (audioContext.currentTime - startTime) * playbackRate;
            sourceNode.stop();
            sourceNode = null;
            isPlaying = false;
        }

        playButton.addEventListener("click", () => {
            if (!isPlaying) {
                playAudio();
            } else {
                pauseAudio();
            }
        });

        speedSlider.addEventListener("input", () => {
            playbackRate = parseFloat(speedSlider.value);
            speedValue.textContent = playbackRate.toFixed(1);
            if (isPlaying) {
                pauseAudio();
                startSource(pausedAt);
            }
        });

        rewindButton.addEventListener("click", () => {
            pausedAt = Math.max(0, (audioContext.currentTime - startTime) * playbackRate - 10);
            if (isPlaying) {
                pauseAudio();
                startSource(pausedAt);
            }
        });

        loadAudio();
    </script>
</body>
</html>
